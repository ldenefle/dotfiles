#!/usr/bin/env python3

import argparse
import os
import subprocess
import sys

parser = argparse.ArgumentParser('gtags-files')
parser.add_argument('file', nargs='?',
                    help='output file, default is stdout')
parser.add_argument('-a', '--append', action='store_true',
                    help='append to output file (if not stdout)')
args = parser.parse_args()

cp = subprocess.run(['git', 'ls-files', '**'], encoding='utf-8',
                    capture_output=True)
out = '\n'.join(os.path.abspath(x) for x in cp.stdout.splitlines()
                if os.path.splitext(x)[1] in ['.c', '.h', '.s', '.S'])

if args.file:
    mode = 'a' if args.append else 'w'
    with open(args.file, mode) as f:
        print(out, file=f)
else:
    print(out, file=sys.stdout)
